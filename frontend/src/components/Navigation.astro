---
import { t, localizePath, type Locale } from '../utils/i18n';

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;
const currentPath = Astro.url.pathname;
const translate = (key: string) => t(locale, key);
const localPath = (path: string) => localizePath(locale, path);

const navItems = [
  { label: translate('nav.home'), href: localPath('/') },
  { label: translate('nav.about'), href: localPath('/about') },
  {
    label: translate('nav.programs'),
    href: localPath('/programs'),
    children: [
      { label: translate('programs.information_systems'), href: localPath('/programs/information-systems') },
      { label: translate('programs.computer_engineering'), href: localPath('/programs/computer-engineering') },
    ]
  },
  { label: translate('nav.lecturers'), href: localPath('/lecturers') },
  { label: translate('nav.admissions'), href: localPath('/admissions') },
  { label: translate('nav.news'), href: localPath('/news') },
  { label: translate('nav.contact'), href: localPath('/contact') },
];

const isActive = (href: string) => {
  if (href === localPath('/')) {
    return currentPath === href || currentPath === `/${locale}` || currentPath === `/${locale}/` || currentPath === '/';
  }
  return currentPath.startsWith(href);
};
---

<nav class="hidden lg:flex items-center space-x-8" aria-label="Main navigation">
  {
    navItems.map((item) => (
      item.children ? (
        <div class="relative group">
          <button
            class:list={[
              'text-gray-700 hover:text-primary-500 font-medium transition-colors flex items-center gap-1',
              isActive(item.href) && 'text-primary-500',
            ]}
            aria-haspopup="true"
            aria-expanded="false"
          >
            {item.label}
            <svg class="w-4 h-4 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div class="absolute top-full left-0 pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200" role="menu">
            <div class="bg-white rounded-lg shadow-lg border py-2 min-w-48">
              {item.children.map((child) => (
                <a
                  href={child.href}
                  class:list={[
                    'block px-4 py-2 text-gray-700 hover:bg-primary-50 hover:text-primary-500 transition-colors',
                    isActive(child.href) && 'text-primary-500 bg-primary-50',
                  ]}
                  role="menuitem"
                >
                  {child.label}
                </a>
              ))}
            </div>
          </div>
        </div>
      ) : (
        <a
          href={item.href}
          class:list={[
            'text-gray-700 hover:text-primary-500 font-medium transition-colors',
            isActive(item.href) && 'text-primary-500 border-b-2 border-primary-500',
          ]}
        >
          {item.label}
        </a>
      )
    ))
  }
</nav>

<!-- Mobile Menu Button -->
<button
  id="mobile-menu-button"
  class="lg:hidden p-2 text-gray-700 hover:text-primary-500"
  aria-label="Toggle mobile menu"
  aria-controls="mobile-menu"
  aria-expanded="false"
>
  <svg
    class="w-6 h-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M4 6h16M4 12h16M4 18h16"></path>
  </svg>
</button>

<!-- Mobile Menu -->
<nav
  id="mobile-menu"
  class="hidden lg:hidden absolute top-full left-0 right-0 bg-white shadow-lg border-t"
  aria-label="Mobile navigation"
>
  <div class="px-4 py-4 space-y-2">
    {
      navItems.map((item) => (
        item.children ? (
          <div class="py-2">
            <div class="text-gray-700 font-medium mb-2">{item.label}</div>
            <div class="pl-4 space-y-2 border-l-2 border-primary-200">
              {item.children.map((child) => (
                <a
                  href={child.href}
                  class:list={[
                    'block text-gray-600 hover:text-primary-500 transition-colors py-1',
                    isActive(child.href) && 'text-primary-500',
                  ]}
                >
                  {child.label}
                </a>
              ))}
            </div>
          </div>
        ) : (
          <a
            href={item.href}
            class:list={[
              'block text-gray-700 hover:text-primary-500 font-medium transition-colors py-2',
              isActive(item.href) && 'text-primary-500',
            ]}
          >
            {item.label}
          </a>
        )
      ))
    }
  </div>
</nav>

<script>
  const button = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');

  button?.addEventListener('click', () => {
    const isHidden = menu?.classList.toggle('hidden');
    button?.setAttribute('aria-expanded', isHidden ? 'false' : 'true');
  });

  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    if (!button?.contains(e.target as Node) && !menu?.contains(e.target as Node)) {
      menu?.classList.add('hidden');
      button?.setAttribute('aria-expanded', 'false');
    }
  });
</script>
